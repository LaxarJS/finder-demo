/** Copyright 2015 aixigo AG, Released under the MIT license: http://laxarjs.org/license */
define("laxar-testing/lib/helpers",["require"],function(a){"use strict";function b(b,c){return new Promise(function(d,e){(c||a)(b,function(){d(Array.prototype.slice.call(arguments,0))},function(a){e(new Error(a))})})}function c(){return{defer:d,all:Promise.all.bind(Promise),resolve:Promise.resolve.bind(Promise),reject:Promise.reject.bind(Promise),when:Promise.resolve.bind(Promise)}}function d(){var a={};return a.promise=new Promise(function(b,c){a.resolve=b,a.reject=c}),a}return{require:b,legacyQ:c}}),define("laxar-testing/lib/mini_http",["laxar"],function(a){"use strict";function b(a,b){var c=b||{},e=new XMLHttpRequest;return a in d?d[a]:(d[a]=new Promise(function(b,d){e.onreadystatechange=function(){try{4===e.readyState&&(e.status>=200&&e.status<=299?b({data:e.responseText,status:e.status}):d({message:"Failed to load file: "+a,data:e.responseText,status:e.status,xhr:e}),e.onreadystatechange=null,e=null)}catch(c){d(c)}},e.open("GET",a,!0),e.setRequestHeader("Cache-Control","no-cache"),Object.keys(c).forEach(function(a){e.setRequestHeader(a,c[a])}),e.send(null)}),d[a])}function c(c,d){var e=a.object.options(d,{Accept:"application/json"});return b(c,e).then(function(a){return JSON.parse(a.data)})}var d={};return{get:b,head:b,getJson:c}}),define("laxar-testing/lib/widget_spec_initializer",["require","laxar","./helpers","./mini_http"],function(a,b,c,d){"use strict";function e(a,b,c,d){return f(a,d).then(g.bind(null,a,b,c,d))}function f(b,d){var e=k.join(b.absSpecLocation,".."),f=k.relative(a.toUrl("."),e),g=d.name.replace(/(.)([A-Z])/g,"$1-$2").toLowerCase();return i(d).then(function(a){var b=[k.join(f,g)].concat(a);return c.require(b)}).then(function(a){return h(a[0],a.slice(1),d.integration.technology)}).then(function(){return{id:"testWidget",widget:k.relative(a.toUrl("laxar-path-widgets"),e)}})}function g(e,f,g,h,i){b._tooling.fileResourceProvider.init(c.legacyQ(),d);var k={load:function(){}},l=b._tooling.path.normalize(a.toUrl("laxar-path-root")),m=b._tooling.fileResourceProvider.create(l);e.options.knownMissingResources.length>0&&j(m,e.options.knownMissingResources);var n=b._tooling.themeManager.create(m,c.legacyQ(),"default");g.featureConfiguration={},g.configure=function(a,c){2===arguments.length?b.object.setPath(g.featureConfiguration,a,b.object.deepClone(c)):g.featureConfiguration=b.object.deepClone(a)},g.load=function(){var a=b.object.options(i,{features:g.featureConfiguration||{}});return b._tooling.widgetLoader.create(c.legacyQ(),m,n,k,e.eventBus).load(a,{onBeforeControllerCreation:function(a,c){["subscribe","publish","publishAndGatherReplies"].forEach(function(b){spyOn(a.context.eventBus,b).and.callThrough()}),b.object.forEach(c,function(a,b){f[b]=a})}}).then(function(a){return a.templatePromise.then(function(c){g.destroy=a.destroy,g.renderTo=function(d){a.adapter.domAttachTo(d,c);var e=b._tooling.widgetAdapters.getFor(h.integration.technology);e.applyViewChanges&&e.applyViewChanges()}})})}}function h(a,d,e){var f=b._tooling.widgetAdapters.getFor(e);return f?"angular"===e?c.require(["angular-mocks"]).then(function(c){var e=c[0],g=f.bootstrap([a]);return e.module(b._tooling.runtimeDependenciesModule.name),e.module(g.name),d.forEach(function(a){a.name&&e.module(a.name)}),e.inject(),f}):(f.bootstrap([a]),Promise.resolve(f)):(b.log.error("Unknown widget technology: [0]",e),Promise.reject(new Error("Unknown widget technology: "+e)))}function i(b){var c=b.controls||[];return Promise.all(c.map(function(b){return d.getJson(a.toUrl(b+"/control")+".json").then(function(a){return b+"/"+a.name})}))}function j(a,b){function c(a){return b.some(function(b){return b instanceof RegExp?b.test(a):-1!==a.indexOf(""+b)})}var d=a.isAvailable.bind(a),e=a.provide.bind(a);a.isAvailable=function(a){return c(a)?Promise.resolve(!1):d(a)},a.provide=function(a){return c(a)?Promise.reject():e(a)}}var k=b._tooling.path;return{createSetupForWidget:e}}),define("laxar-testing/lib/jasmine_boot",["laxar"],function(a){"use strict";function b(b){if(b)return c(b);window.jasmine=jasmineRequire.core(jasmineRequire),jasmineRequire.html(jasmine);var d=jasmine.getEnv(),e=jasmineRequire["interface"](jasmine,d);a.object.extend(window,e);var f=new jasmine.QueryString({getWindowLocation:function(){return window.location}}),g=f.getParam("catch");d.catchExceptions("undefined"==typeof g?!0:g);var h=f.getParam("throwFailures");d.throwOnExpectationFailure(h);var i=new jasmine.HtmlReporter({env:d,onRaiseExceptionsClick:function(){f.navigateWithNewParam("catch",!d.catchingExceptions())},onThrowExpectationsClick:function(){f.navigateWithNewParam("throwFailures",!d.throwingExpectationFailures())},addToExistingQueryString:function(a,b){return f.fullStringWithNewParam(a,b)},getContainer:function(){return document.body},createElement:function(){return document.createElement.apply(document,arguments)},createTextNode:function(){return document.createTextNode.apply(document,arguments)},timer:new jasmine.Timer});d.addReporter(e.jsApiReporter),d.addReporter(i);var j=new jasmine.HtmlSpecFilter({filterString:function(){return f.getParam("spec")}});return d.specFilter=function(a){return j.matches(a.getFullName())},window.setTimeout=window.setTimeout,window.setInterval=window.setInterval,window.clearTimeout=window.clearTimeout,window.clearInterval=window.clearInterval,i.initialize(),c(d)}function c(a){return{run:function(){a.execute()},env:a}}return{create:b}}),define("laxar-testing/laxar-testing",["require","laxar","./lib/helpers","./lib/widget_spec_initializer","./lib/jasmine_boot","promise-polyfill"],function(a,b,c,d,e){"use strict";function f(a,c){var e=b.object.options(c,{knownMissingResources:[]}),f=b._tooling.widgetAdapters.getFor(a.integration.technology),g=f.applyViewChanges?f.applyViewChanges:function(){};return function(c){p.eventBus=b._tooling.eventBus.create(),p.eventBus.flush=function(){k(),g()},t.then(function(b){return b.eventBus=p.eventBus,b.options=e,d.createSetupForWidget(b,p.widget,q,a)})["catch"](l).then(c)}}function g(){q.destroy(),n&&n.parentElement&&(n.parentElement.removeChild(n),n=null)}function h(a){var c=a||{};Object.keys(u).sort(function(a,b){return u[a].AX_SORT_INDEX-u[b].AX_SORT_INDEX}).map(function(a){var d=c[a]||{},e=b.object.extend({},u[a],d);return delete e.AX_SORT_INDEX,{primaryTopic:a,subtopics:e}}).forEach(function(a){Object.keys(a.subtopics).forEach(function(b){var c=a.subtopics[b];c&&p.eventBus.publish(a.primaryTopic+"."+b,c)}),p.eventBus.flush()})}function i(a){return a.substr(0,a.lastIndexOf("/"))}function j(a){v.push(a)}function k(){for(;v.length>0;){var a=v.slice(0);v=[],a.forEach(function(a){a()})}}function l(a){window.console&&window.console.error&&window.console.error(a),jasmine.getEnv().fail(a)}function m(){if("function"==typeof window.setImmediate)Promise._setImmediateFn(window.setImmediate);else if("undefined"!=typeof MessageChannel){var a=new MessageChannel,b={},c=b;a.port1.onmessage=function(){var a=b.next,c=a.task;b=a,c()},Promise._setImmediateFn(function(b){c=c.next={task:b},a.port2.postMessage()})}else{var d=window.setTimeout;Promise._setImmediateFn(function(a){d(a,0)})}}Promise._setImmediateFn&&m();var n,o={configure:function(a,b){if(!q.configure)throw new Error("testing.createSetupForWidget needs to be called prior to configure.");q.configure.apply(q,arguments)},load:function(a){if(!q.load)throw new Error("testing.createSetupForWidget needs to be called prior to load.");if("function"!=typeof a)throw new Error("testing.widget.load needs to be called with a Jasmine done-callback function.");q.load()["catch"](l).then(a)},render:function(){return n&&n.parentElement&&n.parentElement.removeChild(n),n=document.createElement("div"),n.id="widgetContainer",document.body.appendChild(n),q.renderTo(n),n.firstChild}},p={createSetupForWidget:f,widget:o,runSpec:null,eventBus:null,tearDown:g,triggerStartupEvents:h},q={},r=b._tooling.path;b._tooling.eventBus.init(c.legacyQ(),j,j);var s,t=new Promise(function(b,d){p.runSpec=function(f,g){f.title&&(document.title=f.title);var h=f.specUrl||i(window.location.href),j=r.relative(a.toUrl("./"),h),k="."===j[0]?"":"./",l=f.tests.map(function(a){return k+r.join(j,a)});s=e.create(g||null),c.require(["angular-mocks"]).then(c.require.bind(null,l,a)).then(function(){b({jasmineEnv:s.env,absSpecLocation:h}),s.run()})["catch"](function(a){window.console&&window.console.error&&window.console.error(a),d(a),s.env.beforeEach(function(){s.env.fail(a)}),s.run()})}}),u=function(){var a=0;return{didChangeLocale:{AX_SORT_INDEX:a++,"default":{locale:"default",languageTag:"en"}},didChangeTheme:{AX_SORT_INDEX:a++,"default":{theme:"default"}},beginLifecycleRequest:{AX_SORT_INDEX:a++,"default":{lifecycleId:"default"}},didChangeAreaVisibility:{AX_SORT_INDEX:a++,"content.true":{area:"content",visible:!0}},didNavigate:{AX_SORT_INDEX:a++,testing:{place:"testing",target:"_self",data:{}}}}}(),v=[];return p}),define("laxar-testing",["laxar-testing/laxar-testing"],function(a){return a});
//# sourceMappingURL=laxar-testing.min.js.map