<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <script type="text/javascript" src="../../../../../require_config.js" id="require_config"></script>
   <script type="text/javascript" src="spec_runner.js"></script>

   <script type="text/javascript">
      ( function() {
         var s = '/';

         function dirname( f ) {
            return f.substr( 0, f.lastIndexOf( s ) );
         }

         require.baseUrl = dirname( document.getElementById( 'require_config' ).src ) + s + require.baseUrl;

         ( laxarSpec.requireConfig = laxarSpec.requireConfig || {} ).baseUrl = require.baseUrl;

         var requirePath = require.baseUrl + s + require.paths.requirejs;
         var jasminePath = require.baseUrl + s + require.paths.jasmine;
         var jasmineCorePath = dirname( jasminePath );
         var jasmineFavicon = jasminePath.replace( 'lib/jasmine-core', 'images' ) + '_favicon.png';

         document.writeln( '<link type="text/css" rel="stylesheet" href="' + jasminePath + '.css"></link>' );
         document.writeln( '<link type="image/png" rel="shortcut icon" href="' + jasmineFavicon + '"></link>' );
         document.writeln( '<script type="text/javascript" src="' + jasminePath + '.js"><' + '/script>' );
         document.writeln( '<script type="text/javascript" src="' + jasminePath + '-html.js"><' + '/script>' );
         document.writeln( '<script type="text/javascript" src="' + requirePath + '.js"><' + '/script>' );
      } )();
   </script>

   <script type="text/javascript">
      require.config( laxarSpec.requireConfig );

      requirejs.onResourceLoad = function (context, map, depMaps) {
         if (!window.rtree) {
            window.rtree = {
               tree: {},
               map: function() {
                  for (var key in this.tree) {
                     if (this.tree.hasOwnProperty(key)) {
                        var val = this.tree[key];
                        for (var i =0; i < val.deps.length; ++i) {
                           var dep = val.deps[i];
                           val.map[dep] = this.tree[dep];
                        }
                     }
                  }
               },
               toUml: function() {
                  var uml = [];

                  for (var key in this.tree) {
                     if (this.tree.hasOwnProperty(key)) {
                        var val = this.tree[key];
                        for (var i = 0; i < val.deps.length; ++i) {
                           uml.push("[" + key + "]->[" + val.deps[i] + "]");
                        }
                     }
                  }

                  return uml.join("\n");
               }
            };
         }

         var tree = window.rtree.tree;

         function Node() {
            this.deps = [];
            this.map = {};
         }

         if (!tree[map.name]) {
            tree[map.name] = new Node();
         }

         // For a full dependency tree
         if (depMaps) {
            for (var i = 0; i < depMaps.length; ++i) {
               tree[map.name].deps.push(depMaps[i].name);
            }
         }

         // For a simple dependency tree

         //    if (map.parentMap && map.parentMap.name) {
         //        if (!tree[map.parentMap.name]) {
         //            tree[map.parentMap.name] = new Node();
         //        }
         //
         //        if (map.parentMap.name !== map.name) {
         //            tree[map.parentMap.name].deps.push(map.name);
         //        }
         //    }

      };



      require( [
         'laxar-testing'
      ], function( testing ) {
         testing.runSpec( laxarSpec );
      } );
   </script>

</head>
<body></body>
</html>
